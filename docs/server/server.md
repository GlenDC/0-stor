# 0-stor server: zstordb

The 0-stor server, FKA zstordb, is a very simple storage server,
which allows for the creation and management of objects,
which live within a IYO-driven namespace.

This document gives a very high-level overview of the 0-stor server.
Please read [the design document](/docs/server/design.md) to know more about the 0-stor server design.

## Objects

A client (which can be another server of some kind) can create an object by passing data.
It is important to know that the key is chosen by the server,
and returned as a response to the creation of that object.
An object is the combination/link of a key and/with some (binary) data.

It is important to store this key,
as you'll need it in order to get, delete, check and repair the object.

An object's data can be in 3 states. In the best case the data is optimal.
The data is in a valid state in case it can be read with zero problems,
but is none the less damaged and needs repair in order to bring it back to an optimal state.
When data is in an invalid state it cannot be repaired, nor can it be read.

Code references:

+ the in-memory structure used: 
  https://godoc.org/github.com/zero-os/0-stor/server#Object;
+ the encoding logic of an object: 
  https://godoc.org/github.com/zero-os/0-stor/server/encoding#EncodeObject;
+ the decoding logic of an object: 
  https://godoc.org/github.com/zero-os/0-stor/server/encoding#DecodeObject;
+ the KV interface used for object storage: 
  https://godoc.org/github.com/zero-os/0-stor/server/db#DB;

## Namespaces

Objects are stored within a given namespace.
Meaning that all keys are unique only within a given namespace.

A client can only create and manage objects within a namespace,
if it has sufficient permissions to do the requested action.
A client requires separate permissions for reading, writing and deleting objects.
All of those permissions are however implicitly granted,
should the client have admin powers.

Permissions are managed using JWT Tokens, generated using [itsyou.online](https://itsyou.online).

## Data storage

Objects are stored on the local FS of the zstordb server, using badger.
See https://github.com/dgraph-io/badger for more information about badger.

## GRPC

The client can connect and communicate with the (zstordb) server, using the [GRPC](https://grpc.io) framework.
This RPC framework allows the client to call methods on the server, and get a response back.
Authentication (using JWT tokens generated by IYO) is done using GRPC Metadata.

Currently it is only possible to establish a connection between server and client using GRPC,
and there are no plans to change that.

Code references:

+ Server GRPC API: 
  https://godoc.org/github.com/zero-os/0-stor/server/api/grpc;
+ Client GRPC API: 
  https://godoc.org/github.com/zero-os/0-stor/client/datastor/grpc;
